<!DOCTYPE html> 
<html lang='en-US' xml:lang='en-US'> 
<head> <title>Ping</title> 
<meta charset='utf-8' /> 
<meta content='TeX4ht (https://tug.org/tex4ht/)' name='generator' /> 
<meta content='width=device-width,initial-scale=1' name='viewport' /> 
<link href='index.css' rel='stylesheet' type='text/css' /> 
<meta content='index.tex' name='src' /> 
<script>window.MathJax = { tex: { tags: "ams", }, }; </script> 
 <script async='async' id='MathJax-script' src='https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js' type='text/javascript'></script>  
</head><body>
   <div class='maketitle'>
                                                                  

                                                                  
                                                                  

                                                                  

<h2 class='titleHead'>Ping</h2>
 <div class='author'><span class='ecrm-1200'>Vicente González Ruiz</span></div><br />
<div class='date'><span class='ecrm-1200'>January 31, 2024</span></div>
   </div>
   <h3 class='likesectionHead'><a id='x1-1000'></a>Contents</h3>
   <div class='tableofcontents'>
    <span class='sectionToc'>1 <a href='#x1-20001' id='QQ2-1-2'>Time measurement</a></span>
<br />    <span class='sectionToc'>2 <a href='#x1-30002' id='QQ2-1-4'>Bit-rate measurement</a></span>
<br />    <span class='sectionToc'><a href='#Q1-1-5'>References</a></span>
   </div>
<!-- l. 8 --><p class='noindent'>
</p>
   <h3 class='sectionHead'><span class='titlemark'>1   </span> <a id='x1-20001'></a>Time measurement</h3>
<!-- l. 9 --><p class='noindent'>Ping can provide statistics about latencies.
</p>
   <figure class='figure'> 

                                                                  

                                                                  
                                                                  

                                                                  
<div class='center'>
<!-- l. 12 --><p class='noindent'>
</p><!-- l. 13 --><p class='noindent'><div style='text-align:center;'> <img src='graphics/ping_timeline.svg' /> </div>  </p></div>
<a id='x1-2001r1'></a>
<figcaption class='caption'><span class='id'>Figure 1:  </span><span class='content'>Timeline  of  a  ping  interaction  between  two  hosts  A  and  B,
interconnected by simple communication link.
</span></figcaption><!-- tex4ht:label?: x1-2001r1  -->
                                                                  

                                                                  
   </figure>
<!-- l. 21 --><p class='indent'>   To measure latencies, we will use <a href='https://github.com/torvalds/linux/blob/master/net/ipv4/ping.c'><span class='ectt-1000'>ping</span></a> <span class='cite'>[<span class='ecbx-1000'>?</span>, <span class='ecbx-1000'>?</span>]</span>, a tool that <a href='https://en.wikipedia.org/wiki/Ping_(networking_utility)'>sends</a> (one or more)
<a href='https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol'>ICMP</a> Echo Request messages to an IP address and waits for receiving (one or more)
ICMP Echo Reply messages generated by the (<a href='https://en.wikipedia.org/wiki/Operating_system'>OS</a> of that) host, measuring the so
called <a href='https://en.wikipedia.org/wiki/Round-trip_delay'>RTT</a> (Round-Trip Time). For example, in the Figure <a href='#x1-2001r1'>1<!-- tex4ht:ref: fig:ping_timeline  --></a> are described the
different time components in which a RTT can be decomposed. In this figure, \(t_t\)
stands for <span class='ecti-1000'>transmission time</span>, and \(t_p\) (again) for <span class='ecti-1000'>propagation time</span>. A simple
link (two wires, for example) using <a href='https://en.wikipedia.org/wiki/Time-division_multiple_access'>TDM</a> (Time-Domain Multiplexing) has
been supposed. For this reason, the propagation and transmission times are
identical in both directions. Notice that if the payload of the <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>ping</span></span></span> message has
only 64 bytes (the default value in most <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>ping</span></span></span> implementations) and the
bit rate of the link is high, then \(t_p\gg t_t.\) In a LAN, for example, it also holds that
\begin {equation}  \text {RTT} = 2t_p + 2t_t. \label {eq:RTT}  \end {equation}<a id='x1-2002r1'></a>
</p>
   <h3 class='sectionHead'><span class='titlemark'>2   </span> <a id='x1-30002'></a>Bit-rate measurement</h3>
<!-- l. 51 --><p class='noindent'>Usually, to determine the throughput, we need to use a tool such as <a href='https://iperf.fr/'>iPerf</a> to
<a href='https://en.wikipedia.org/wiki/Measuring_network_throughput'>measure the link capacity</a> between two <a href='https://datatracker.ietf.org/doc/html/rfc4113'>end-points</a> (of different <a href='https://en.wikipedia.org/wiki/Host_(network)'>hosts</a>) in the
Internet. Unfortunately, this procedure implies that we must have access to
both hosts to install and run this program, privileges that are not always
available.
</p><!-- l. 61 --><p class='indent'>   Alternatively, we can estimate the <a href='https://en.wikipedia.org/wiki/Throughput'>link throughput</a> using <a href='https://github.com/torvalds/linux/blob/master/net/ipv4/ping.c'><span class='ectt-1000'>ping</span></a>. However, it is
important to realize that <span class='ectt-1000'>ping </span>has been designed to measure latencies, not
bit-rates, and that, for this reason, we will only be able to estimate throughputs,
rougtly.
</p><!-- l. 68 --><p class='indent'>   Said that, the transmission bitrate available between two directly reachable IP
devices can be found with \begin {equation}  b=\frac {B}{t_t}, \label {eq:b}  \end {equation}<a id='x1-3001r2'></a> where \(B\) is the number of bits sent in a <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>ping</span></span></span> <a href='https://en.wikipedia.org/wiki/Payload_(computing)'>payload</a>,
and \begin {equation}  t_t = \frac {\text {RTT}_{\text {max}}-2t_p}{2}, \label {eq:tt}  \end {equation}<a id='x1-3002r3'></a> an equation that can be determined by revisiting the <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>ping</span></span></span> timeline
shown in the Figure <a href='#x1-2001r1'>1<!-- tex4ht:ref: fig:ping_timeline  --></a> and the Eq. <a href='#x1-2002r1'>1<!-- tex4ht:ref: eq:RTT  --></a>. In this expression, \(\text {RTT}_{\text {max}}\) represents the
average<span class='footnote-mark'><a href='#fn1x0' id='fn1x0-bk'><sup class='textsuperscript'>1</sup></a></span><a id='x1-3003f1'></a> RTT measured
when we send the maximum<span class='footnote-mark'><a href='#fn2x0' id='fn2x0-bk'><sup class='textsuperscript'>2</sup></a></span><a id='x1-3005f2'></a>
number of bytes in the payload of the <span class='obeylines-h'><span class='verb'><span class='ectt-1000'>ping</span></span></span>, and \begin {equation}  t_p \approx \frac {\text {RTT}_{\text {min}}}{2}, \label {eq:tp}  \end {equation}<a id='x1-3007r4'></a> where \(\text {RTT}_{\text {min}}\) presents the
minimum<span class='footnote-mark'><a href='#fn3x0' id='fn3x0-bk'><sup class='textsuperscript'>3</sup></a></span><a id='x1-3008f3'></a> RTT measurement
when we send the minimum<span class='footnote-mark'><a href='#fn4x0' id='fn4x0-bk'><sup class='textsuperscript'>4</sup></a></span><a id='x1-3010f4'></a>
payload.
</p><!-- l. 100 --><p class='indent'>   Therefore, to estimate \(b\) for the near future, we must perform the following
steps:
</p><!-- l. 103 --><p class='indent'>
     </p><ol class='enumerate1'>
<li class='enumerate' id='x1-3013x1'>Run <span class='ectt-1000'>ping </span>using the smallest possible payload that provides RTTs values.<span class='footnote-mark'><a href='#fn5x0' id='fn5x0-bk'><sup class='textsuperscript'>5</sup></a></span><a id='x1-3014f5'></a>
     Use it to calculate \(t_p\).
                                                                  

                                                                  
     </li>
<li class='enumerate' id='x1-3017x2'>Run <span class='ectt-1000'>ping </span>using the largest possible payload to achieve that the most part
     of the average RTT provided by <span class='ectt-1000'>ping </span>corresponds to \(t_t\). It is necessary to
     use the highest payload-size because the accuracy of the cronometer used
     by <span class='ectt-1000'>ping</span>, in general, is not high enough.
     </li>
<li class='enumerate' id='x1-3019x3'>Use Eq. \eqref{eq:tt} to find \(t_t\) as a function of the average RTT and the
     minimal \(t_p\).
     </li>
<li class='enumerate' id='x1-3021x4'>Finally, use Eq. \eqref{eq:b} to determine \(b\).
</li></ol>
<!-- l. 124 --><p class='indent'>   If the devices cannot be <span class='ectt-1000'>ping</span>-ed, and supposing that there is only one point in
the communication link that is filtering the ICMP Echo Request traffic in each
direction, then we can compute the total RTT as the sum of the RTTs from the
devices that we want to connect (where the InterCom is it supposed to be run) to the
filter (possiblely, one of your home routers).
<a id='Q1-1-5'></a>
</p>
   <div class='footnotes'><a id='x1-3004x2'></a>
<!-- l. 84 --><p class='indent'>     <span class='footnote-mark'><a href='#fn1x0-bk' id='fn1x0'><sup class='textsuperscript'>1</sup></a></span><span class='ecrm-0800'>Remember that ping can generate a number of time measurements.</span></p><a id='x1-3006x2'></a>
<!-- l. 87 --><p class='indent'>     <span class='footnote-mark'><a href='#fn2x0-bk' id='fn2x0'><sup class='textsuperscript'>2</sup></a></span><span class='ecrm-0800'>We should use a payload as large as possible (ideally, an infinite number of bytes), in order
</span><span class='ecrm-0800'>to make</span> \(t_t\) <span class='ecrm-0800'>a significant amount of time, which is easy to measure</span></p><a id='x1-3009x2'></a>
<!-- l. 96 --><p class='indent'>     <span class='footnote-mark'><a href='#fn3x0-bk' id='fn3x0'><sup class='textsuperscript'>3</sup></a></span><span class='ecrm-0800'>Again, remember that ping returns a collection of RTTs, a we should use the minimun
</span><span class='ecrm-0800'>beause the latency of the link should be a constant and the congestion always increases this
</span><span class='ecrm-0800'>value.</span></p><a id='x1-3011x2'></a>
<!-- l. 98 --><p class='indent'>     <span class='footnote-mark'><a href='#fn4x0-bk' id='fn4x0'><sup class='textsuperscript'>4</sup></a></span><span class='ecrm-0800'>If the payload of the ping is small enough (</span>\(0\) <span class='ecrm-0800'>bytes ideally), it would happen that</span>
\(t_t=0\)<span class='ecrm-0800'>.</span></p><a id='x1-3015x5'></a>
<!-- l. 109 --><p class='noindent'><span class='footnote-mark'><a href='#fn5x0-bk' id='fn5x0'><sup class='textsuperscript'>5</sup></a></span><span class='ecrm-0800'>The minimal payload for a </span><span class='ectt-0800'>ping </span><span class='ecrm-0800'>message can be 0, but depending on the implementation
</span><span class='ecrm-0800'>of </span><span class='ectt-0800'>ping </span><span class='ecrm-0800'>you might have to use a larger value.</span></p>                                                               </div>
 
</body> 
</html>